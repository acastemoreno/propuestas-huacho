function truncate(e){return e|0}function updateInfo(e){$("#Upload_x").val(truncate(e.x*rexpand));$("#Upload_y").val(truncate(e.y*rexpand));$("#Upload_w").val(truncate(e.w*rexpand));$("#Upload_h").val(truncate(e.h*rexpand));if(parseInt(e.w)>0){xsize=$preview.width();var t=xsize/e.w;var n=(boundy-t*e.h-100)/2;if(n>0){$preview.css({marginTop:Math.round(n)+"px"});$pcnt.css({height:Math.round(t*e.h)+"px",width:Math.round(xsize)+"px",marginLeft:"0px"})}else{var r=boundy-100;var t=r/e.h;$preview.css({marginTop:"0px"});$pcnt.css({height:Math.round(r)+"px",marginLeft:Math.round((xsize-t*e.w)/2)+"px",width:Math.round(t*e.w)+"px"})}$pimg.css({width:Math.round(t*boundx)+"px",height:Math.round(t*boundy)+"px",marginLeft:"-"+Math.round(t*e.x)+"px",marginTop:"-"+Math.round(t*e.y)+"px"})}}function clearInfo(){$("#Upload_x").removeAttr("value");$("#Upload_y").removeAttr("value");$("#Upload_w").removeAttr("value");$("#Upload_h").removeAttr("value")}function checkForm(){if(parseInt($("#Restaimagen_w").val()))return true;$(".error").html("Por favor, selecciona un área a recortar y luego haz clic en Guardar Imagen").show();return false}function fileSelectHandler(){var e=$("#Upload_file")[0].files[0];$(".error").hide();$(".error").parent().parent().removeClass("has-error");if(!e){$(".error").parent().parent().addClass("has-error");$(".error").html("Por favor, selecciona una imagen").show();$("#form-preview").attr("style","display: none;");$("#form-preview").html('<div class="col-md-8"> <div id="crop-modal-ct"><!--#crop-modal-ct starts here--> </div> <img id="preview" /> </div> <div class="col-md-4"> <div id="image-ct"> <div id="preview-panel"> <p>Previsualizacion de imagen</p> <div class="preview-container"> <img class="jcrop-preview" id="j-preview" alt="Imagen de Voucher" /> </div> <input id="submit-form" type="submit" class="btn btn-default" value="Subir Voucher" /> </div> </div> </div>');clearInfo();return}var t=/^(image\/jpeg|image\/png)$/i;if(!t.test(e.type)){$(".error").parent().parent().addClass("has-error");$(".error").html("Por favor, selecciona un formato de imagen válido(jpg y png son permitidos)").show();$("#form-preview").attr("style","display: none;");$("#form-preview").html('<div class="col-md-8"> <div id="crop-modal-ct"><!--#crop-modal-ct starts here--> </div> <img id="preview" /> </div> <div class="col-md-4"> <div id="image-ct"> <div id="preview-panel"> <p>Previsualizacion de imagen</p> <div class="preview-container"> <img class="jcrop-preview" id="j-preview" alt="Imagen de Voucher" /> </div> <input id="submit-form" type="submit" class="btn btn-default" value="Subir Voucher" /> </div> </div> </div>');clearInfo();return}$preview=$("#preview-panel"),$pcnt=$("#preview-panel .preview-container"),$pimg=$("#preview-panel .preview-container img");var n=document.getElementById("preview");var r=document.getElementById("j-preview");var i=new FileReader;i.onload=function(e){n.src=e.target.result;n.onload=function(){var t;r.src=e.target.result;$("#form-preview").fadeIn(200);t=$(n).width();rexpand=n.naturalWidth/t;if(typeof jcrop_api!="undefined"){jcrop_api.destroy()}$("#preview").Jcrop({bgFade:true,bgOpacity:.3,bgColor:"black",boxWidth:670,boxHeight:0,onChange:updateInfo,onSelect:updateInfo,onRelease:clearInfo},function(){var e=this.getBounds();boundx=e[0];boundy=e[1];minx=boundx/5;miny=boundy/5;jcrop_api=this;jcrop_api.setOptions({minSize:[minx,miny]},{bgFade:true});jcrop_api.setSelect([minx,miny,minx*4,miny*4]);jcrop_api.ui.selection.addClass("jcrop-selection")})}};i.readAsDataURL(e)}var jcrop_api,rexpand,boundx,minx,miny,xsize,ysize,boundy,preview,pcnt,pimg;